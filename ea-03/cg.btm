RULE begin cg
CLASS EscapeAnalysisBasicBlockBuilder
METHOD <init>
AT EXIT
BIND
  method = $2.getCurrentElement().toString().replaceAll("[\\.\\[(/;)]", "_")
IF
  $2.getCurrentElement().toString().startsWith("example")
DO
  traceOpen($2.getCurrentElement(), method + ".dot");
  trace($2.getCurrentElement(), "digraph " + method + " {\n");
ENDRULE

RULE cg field edge if absent
CLASS EscapeAnalysis$ConnectionGraph
METHOD addFieldEdgeIfAbsent
AT EXIT
BIND
  obj = $1.toString().replaceAll("[\\.@]", "_");
  field = $2.toString().replaceAll("[\\.@]", "_");
  success = $!;
IF
  $this.element.toString().startsWith("example")
  AND
  success
DO
  trace($this.element, obj + " -> " + field + " [label = \"F\"]\n");
ENDRULE

RULE cg points-to edge if absent
CLASS EscapeAnalysis$ConnectionGraph
METHOD addPointsToEdgeIfAbsent
AT EXIT
BIND
  ref = $1.toString().replaceAll("[\\.@]", "_");
  obj = $2.toString().replaceAll("[\\.@]", "_");
  success = $!;
IF
  $this.element.toString().startsWith("example")
  AND
  success
DO
  trace($this.element, ref + " -> " + obj + " [label = \"P\"]\n");
ENDRULE

RULE close cg graph
CLASS EscapeAnalysis$ConnectionGraph
METHOD methodExit
AT EXIT
IF
  $this.element.toString().startsWith("example")
DO trace($this.element, "}\n")
ENDRULE
